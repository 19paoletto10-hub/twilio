<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Twilio Chat App â€” PeÅ‚na dokumentacja</title>
  <meta name="description" content="Profesjonalna dokumentacja produktu Twilio Chat App â€” opis funkcji, architektury, UX i scenariuszy biznesowych.">
  <style>
    :root{--bg:#f7f9fb;--card:#ffffff;--muted:#6c757d;--accent:#0d6efd;--accent-2:#0b5ed7}
    html,body{height:100%}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;line-height:1.65;color:#172042;background:var(--bg)}
    .container{max-width:1100px;margin:36px auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;background:var(--card);padding:16px 18px;border-radius:12px;border:1px solid #eef2fb;box-shadow:0 10px 24px rgba(20,30,60,0.05)}
    .brand{display:flex;gap:16px;align-items:center}
    .logo{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    h1{font-size:1.6rem;margin:0}
    h2{margin:0 0 10px;font-size:1.25rem}
    h3{margin:14px 0 8px;font-size:1.05rem}
    h4{margin:12px 0 6px;font-size:1.0rem}
    p{margin:10px 0}
    ul,ol{margin:10px 0 10px 20px}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .meta{color:var(--muted);font-size:0.95rem}
    nav.toc{margin-top:18px;display:flex;gap:12px;flex-wrap:wrap}
    nav.toc a{background:#fff;padding:8px 12px;border-radius:999px;border:1px solid #e6eefb;color:var(--accent);text-decoration:none;font-weight:600}
    nav.toc a:hover{border-color:#dbeafe;background:#f8fbff}
    section.card{background:var(--card);padding:20px;border-radius:10px;margin-top:18px;box-shadow:0 6px 18px rgba(20,30,60,0.04)}
    section.card > h2{padding-bottom:10px;border-bottom:1px solid #eef2fb}
    /* PDF/legacy-friendly layout: flex first, grid if supported */
    .row{display:flex;align-items:flex-start;gap:20px}
    .row > main{flex:1;min-width:0}
    .row > aside{flex:0 0 340px;width:340px}
    .lead{color:var(--muted);margin-bottom:12px}
    .muted{color:var(--muted)}
    .features{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
    .feature{flex:1 1 220px}
    .feature{background:#f8fbff;padding:12px;border-radius:8px;border:1px solid #eaf4ff}
    aside.sidebar{position:sticky;top:24px;height:max-content}
    .screenshot{background:#ffffff;border-radius:12px;border:1px solid #eef2fb;padding:12px}
    .screenshot img{width:100%;height:auto;border-radius:12px;border:1px solid #eef2fb;display:block}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef4ff;border:1px solid #dbeafe;color:var(--accent);font-weight:700;font-size:0.85rem;vertical-align:baseline}
    .kpi{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .kpi .tag{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef4ff;border:1px solid #dbeafe;color:var(--accent);font-weight:700;font-size:0.9rem}
    .panel-notes{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
    .panel-notes .note{flex:1 1 280px}
    .note{background:#f8fbff;padding:12px;border-radius:8px;border:1px solid #eaf4ff}
    .note h4{margin:0 0 6px}
    .note ul{margin:6px 0 0 18px}
    .hint{font-size:0.92rem;color:var(--muted)}
    figure{margin:0}
    figcaption{font-size:0.9rem;color:var(--muted);margin-top:8px}
    figure.doc-figure{margin-top:12px}
    figure.doc-figure .screenshot{padding:12px}
    figure.doc-figure img{max-width:100%;height:auto}
    figure.doc-figure figcaption{line-height:1.45}
    .cta{display:inline-block;background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700}
    table.spec{width:100%;border-collapse:collapse;margin-top:12px}
    table.spec th{padding:10px 8px;text-align:left;background:#f8fbff;border-bottom:1px solid #eef2fb}
    table.spec td{padding:10px 8px;border-bottom:1px solid #eef2fb}
    .code{background:#0f1724;color:#f1f5f9;padding:6px 8px;border-radius:6px;font-family:monospace}
    pre.code{margin:10px 0;white-space:pre-wrap;word-break:break-word}
    .callout{background:#f8fbff;border:1px solid #eaf4ff;border-radius:10px;padding:12px}
    .callout strong{display:inline-block;margin-bottom:4px}
    .two-col{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .two-col > div{flex:1 1 320px}
    @supports (display:grid){
      .row{display:grid;grid-template-columns:1fr 340px}
      .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
      .panel-notes{display:grid;grid-template-columns:repeat(3,1fr)}
      .panel-notes .note{flex:unset}
      .feature{flex:unset}
    }
    footer{margin-top:28px;text-align:center;color:var(--muted);font-size:0.9rem}
    @media(max-width:920px){.row{flex-direction:column}.row > aside{width:auto;flex:1 1 auto}.sidebar{position:relative}.panel-notes{grid-template-columns:1fr}} 
    @media print{
      @page{size:A4;margin:12mm}
      *{-webkit-print-color-adjust:exact;print-color-adjust:exact}
      body{background:#fff}
      .container{margin:0;max-width:none}
      nav.toc{display:none}
      section.card{box-shadow:none;border:1px solid #eef2fb}
      .row{display:block}
      aside.sidebar{display:none}
      a.cta{display:none}
      a[href]:after{content:" (" attr(href) ")";font-size:0.85em;color:var(--muted)}
      section.card, figure, .panel-notes{break-inside:avoid;page-break-inside:avoid}
      figure.doc-figure{margin-top:8mm}
      figure.doc-figure .screenshot{padding:6mm;border-radius:10px}
      figure.doc-figure img{max-height:165mm;object-fit:contain}
      figure.doc-figure figcaption{margin-top:3mm;font-size:9.5pt}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">TC</div>
        <div>
          <h1>Twilio Chat App â€” Kompleksowa dokumentacja</h1>
          <div class="meta">Opis produktu, architektura, scenariusze biznesowe &amp; wskazÃ³wki wdroÅ¼eniowe</div>
        </div>
      </div>
      <div style="text-align:right">
        <div class="meta">ver3.2.3 â€¢ 2025-12-23</div>
        <a class="cta" href="#download">Pobierz PDF</a>
      </div>
    </header>

    <nav class="toc" aria-label="Spis treÅ›ci">
      <a href="#overview">PrzeglÄ…d</a>
      <a href="#features">Funkcje</a>
      <a href="#quickstart">Szybki start</a>
      <a href="#config">Konfiguracja</a>
      <a href="#architecture">Architektura</a>
      <a href="#flows">PrzepÅ‚ywy</a>
      <a href="#ux">Panel â€” zakÅ‚adki</a>
        <a href="#monitoring">Logi & monitoring</a>
      <a href="#multi-sms">Multiâ€‘SMS</a>
      <a href="#news">News / FAISS</a>
      <a href="#data">Dane (SQLite)</a>
      <a href="#api">API</a>
      <a href="#glossary">Glosariusz</a>
      <a href="#ai">AI & Autoâ€‘reply</a>
      <a href="#security">BezpieczeÅ„stwo</a>
      <a href="#operations">Operacje</a>
      <a href="#deploy">Deployment</a>
    </nav>

    <div class="row">
      <main>
        <section id="overview" class="card">
          <h2>PrzeglÄ…d rozwiÄ…zania</h2>
          <p class="lead">Twilio Chat App to dedykowane rozwiÄ…zanie dla firm, ktÃ³re potrzebujÄ… bezpiecznego, kontrolowanego kanaÅ‚u komunikacji SMS/MMS z moÅ¼liwoÅ›ciÄ… automatyzacji i integracji z modelami AI. Produkt Å‚Ä…czy prostotÄ™ obsÅ‚ugi z politykÄ… audytowalnoÅ›ci i peÅ‚nym zapisem danych.</p>
          <div class="features">
            <div class="feature"><strong>Panel operatora</strong><div class="muted">Intuicyjny interfejs dla zespoÅ‚Ã³w obsÅ‚ugi</div></div>
            <div class="feature"><strong>Autoâ€‘reply & AI</strong><div class="muted">Tryby automatycznych odpowiedzi z logikÄ… biznesowÄ…</div></div>
            <div class="feature"><strong>REST API</strong><div class="muted">Integracja z systemami CRM i narzÄ™dziami zewnÄ™trznymi</div></div>
            <div class="feature"><strong>SQLite</strong><div class="muted">Åatwa persystencja i prosty backup plikowy</div></div>
          </div>
          <div class="kpi" aria-label="Szybkie podsumowanie">
            <span class="tag">ver3.2.3</span>
            <span class="tag">Flask + Twilio</span>
            <span class="tag">Workery w tle</span>
            <span class="tag">FAISS / RAG</span>
            <span class="tag">Multiâ€‘SMS</span>
          </div>
        </section>

        <section id="features" class="card">
          <h2>Kluczowe funkcje</h2>
          <ul>
            <li><strong>Dashboard & WiadomoÅ›ci</strong> â€” szybki wglÄ…d w wszystkie konwersacje, filtry, podglÄ…d statusÃ³w i peÅ‚ny audit trail.</li>
            <li><strong>Czat 1:1</strong> â€” zakÅ‚adka dedykowana pojedynczemu numerowi z inteligentnym przewijaniem, notatkami i wsparciem MMS.</li>
            <li><strong>Zwijany Sidebar <span class="badge">3.2.1</span></strong> â€” collapsible sidebar (280px â†’ 84px) z persystencjÄ… stanu, szybkimi akcjami i responsywnym overlay na mobile.</li>
            <li><strong>Modal kompozycji <span class="badge">3.2.1</span></strong> â€” nowoczesne okno do tworzenia wiadomoÅ›ci z walidacjÄ… numeru, licznikiem znakÃ³w i skrÃ³tami klawiszowymi.</li>
            <li><strong>Autoâ€‘reply & AI Studio</strong> â€” przeÅ‚Ä…czanie trybÃ³w odpowiedzi (szablon, AI, fallback bot) i testy bez wysyÅ‚ki.</li>
            <li><strong>Przypomnienia</strong> â€” harmonogram cyklicznych SMS-Ã³w z kontrolÄ… statusu i logiem prÃ³b wysyÅ‚ki.</li>
            <li><strong>Multiâ€‘SMS</strong> â€” kampanie do wielu odbiorcÃ³w: import numerÃ³w w dowolnym formacie, deduplikacja, raporty sukcesÃ³w/bÅ‚Ä™dÃ³w.</li>
            <li><strong>News / FAISS / RAG <span class="badge">3.2.3</span></strong> â€” scraping z SSE streaming (live progress), przycisk zatrzymania, masowe usuwanie plikÃ³w, profesjonalny podglÄ…d artykuÅ‚Ã³w, backup indeksu.</li>
            <li><strong>DÅ‚ugie treÅ›ci bez awarii</strong> â€” AI/News mogÄ… generowaÄ‡ dÅ‚uÅ¼sze odpowiedzi; aplikacja dzieli je na bezpieczne czÄ™Å›ci (1500 znakÃ³w) i wysyÅ‚a jako kilka SMS.</li>
            <li><strong>API + webhooki</strong> â€” REST API do integracji z CRM i automatyzacjÄ…, w tym wysyÅ‚kÄ…, pobieraniem historii i zarzÄ…dzaniem workerami.</li>
            <li><strong>Operacje & DevOps</strong> â€” docker-compose, healthcheck, logowanie strukturalne i rozpisany runbook prod.</li>
          </ul>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_wiadomosci.jpg" alt="Dashboard â€” wiadomoÅ›ci">
            </div>
            <figcaption>Dashboard jako centrum dowodzenia â€” szczegÃ³Å‚owy opis znajdziesz w sekcji â€Panel â€” zakÅ‚adkiâ€.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” wiadomoÅ›ci">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>PrzykÅ‚ad spÃ³jnego UI â€” jedna paleta kolorÃ³w, badge statusÃ³w, czytelne odstÄ™py.</li>
                <li>Elementy powtarzajÄ…ce siÄ™ w innych zakÅ‚adkach (karty, toasty, filtry).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co moÅ¼esz zrobiÄ‡</h4>
              <ul>
                <li>MonitorowaÄ‡ rozmowy na Å¼ywo, przeÅ‚Ä…czaÄ‡ zakÅ‚adki i diagnozowaÄ‡ statusy.</li>
                <li>UÅ¼ywaÄ‡ UI jako wzorca dla wÅ‚asnych integracji (np. zachowaÄ‡ to samo nazewnictwo statusÃ³w).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>UI korzysta z tych samych endpointÃ³w REST, ktÃ³re udostÄ™pniamy integratorom.</li>
                <li>Wszystkie interakcje sÄ… auditowane â€” layout ma na to wpÅ‚yw (np. rozrÃ³Å¼nienie inbound/outbound).</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="quickstart" class="card">
          <h2>Szybki start (lokalnie)</h2>
          <p class="lead">Minimalny zestaw do uruchomienia systemu w trybie developerskim: Python, konto Twilio i podstawowa konfiguracja Å›rodowiska. AI/FAISS jest opcjonalne.</p>

          <div class="two-col" aria-label="Szybki start â€” kroki">
            <div class="callout">
              <strong>Wymagania</strong>
              <ul>
                <li>Python 3.10+</li>
                <li>Konto Twilio (numer SMS lub Messaging Service)</li>
                <li>(Opcjonalnie) OpenAI dla AI autoâ€‘reply oraz RAG/FAISS</li>
              </ul>
            </div>
            <div class="callout">
              <strong>Uruchomienie</strong>
              <pre class="code">python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp .env.example .env

python run.py</pre>
              <div class="hint">Panel domyÅ›lnie dziaÅ‚a pod adresem <span class="code">http://0.0.0.0:3000</span>.</div>
            </div>
          </div>

          <div class="callout" style="margin-top:12px">
            <strong>Webhooki Twilio</strong>
            <p class="muted">Po uruchomieniu ustaw w Twilio adresy webhookÃ³w na:</p>
            <ul>
              <li><span class="code">PUBLIC_BASE_URL/twilio/inbound</span> (Incoming)</li>
              <li><span class="code">PUBLIC_BASE_URL/twilio/status</span> (Status Callback)</li>
            </ul>
          </div>
        </section>

        <section id="config" class="card">
          <h2>Konfiguracja Å›rodowiska (.env)</h2>
          <p class="lead">Konfiguracja jest oparta o zmienne Å›rodowiskowe. System wymaga minimum danych Twilio; funkcje AI/FAISS aktywujÄ… siÄ™ dopiero po ustawieniu klucza OpenAI.</p>

          <h3>NajwaÅ¼niejsze zmienne</h3>
          <pre class="code"># Twilio
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_DEFAULT_FROM=+48123456789
TWILIO_MESSAGING_SERVICE_SID=

# Aplikacja
APP_HOST=0.0.0.0
APP_PORT=3000
APP_DEBUG=true
DB_PATH=data/app.db
PUBLIC_BASE_URL=https://twoja-domena.pl
TWILIO_VALIDATE_SIGNATURE=true

# OpenAI â€“ News/FAISS (RAG)
SECOND_OPENAI=sk-...
SECOND_MODEL=gpt-4o-mini
EMBEDDING_MODEL=text-embedding-3-large</pre>

          <div class="panel-notes" aria-label="Konfiguracja â€” praktyka">
            <div class="note">
              <h4>Tryb dev vs prod</h4>
              <ul>
                <li>W prod ustaw <span class="code">APP_DEBUG=false</span> i zostaw <span class="code">TWILIO_VALIDATE_SIGNATURE=true</span>.</li>
                <li>W dev moÅ¼esz wyÅ‚Ä…czyÄ‡ walidacjÄ™ podpisu tylko na czas testÃ³w lokalnych.</li>
              </ul>
            </div>
            <div class="note">
              <h4>AI / FAISS</h4>
              <ul>
                <li>Brak <span class="code">SECOND_OPENAI</span> wyÅ‚Ä…cza integracjÄ™ OpenAI i ogranicza funkcje RAG/embeddings.</li>
                <li>Modele moÅ¼na zmieniaÄ‡ bez modyfikacji kodu (zmienne Å›rodowiskowe).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Nadawca Twilio</h4>
              <ul>
                <li>Ustaw <span class="code">TWILIO_DEFAULT_FROM</span> albo <span class="code">TWILIO_MESSAGING_SERVICE_SID</span>.</li>
                <li>Panel sygnalizuje brak konfiguracji nadawcy.</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="architecture" class="card">
          <h2>Architektura techniczna</h2>
          <p class="lead">Modularna aplikacja Flask z dedykowanymi moduÅ‚ami integracji i workerami. Architektura jest zoptymalizowana pod operacje (logi, przewidywalnoÅ›Ä‡, prosty backup) i minimalnÄ… liczbÄ™ zaleÅ¼noÅ›ci (SQLite jako gÅ‚Ã³wny store).</p>
          <table class="spec">
            <tr><th>Komponent</th><th>Rola</th></tr>
            <tr><td>`webhooks_bp`</td><td>HTTP webhooki Twilio i API</td></tr>
            <tr><td>`ai_service`</td><td>Generowanie odpowiedzi AI i budowa kontekstu</td></tr>
            <tr><td>`multi_sms.py`</td><td>Worker batchowy dla kampanii Multiâ€‘SMS i rezerwacja zadaÅ„</td></tr>
            <tr><td>`twilio_client`</td><td>Warstwa wysyÅ‚ki wiadomoÅ›ci i zarzÄ…dzania wÄ…tkami</td></tr>
            <tr><td>`database.py`</td><td>SQLite, migracje, helpery biznesowe</td></tr>
          </table>

          <div class="callout" style="margin-top:12px">
            <strong>NajwaÅ¼niejsza idea</strong>
            <p class="muted">Panel WWW, webhooki Twilio, workery i operacje News/FAISS opierajÄ… siÄ™ o wspÃ³lny magazyn (SQLite + katalog danych). DziÄ™ki temu system jest audytowalny i odporny na restart.</p>
          </div>
        </section>

        <section id="flows" class="card">
          <h2>PrzepÅ‚ywy (endâ€‘toâ€‘end)</h2>
          <p class="lead">PoniÅ¼sze scenariusze opisujÄ… â€co dzieje siÄ™ od klikniÄ™cia do efektuâ€ â€” w ujÄ™ciu operacyjnym i technicznym.</p>

          <h3>Inbound wiadomoÅ›Ä‡ (Twilio â†’ system)</h3>
          <ol>
            <li>Twilio wywoÅ‚uje webhook <span class="code">POST /twilio/inbound</span>.</li>
            <li>System waliduje podpis (produkcyjnie) i zapisuje wiadomoÅ›Ä‡ w SQLite.</li>
            <li>JeÅ›li aktywny jest autoâ€‘reply (klasyczny lub AI), wiadomoÅ›Ä‡ trafia do kolejki workera.</li>
            <li>Worker generuje odpowiedÅº i wysyÅ‚a przez Twilio; rezultat jest audytowany w historii.</li>
          </ol>

          <h3>Outbound z panelu (operator â†’ klient)</h3>
          <ol>
            <li>Operator wysyÅ‚a wiadomoÅ›Ä‡ w UI (chat).</li>
            <li>Frontend wywoÅ‚uje API wysyÅ‚ki (SMS/MMS).</li>
            <li>System zapisuje rekord wiadomoÅ›ci i nadaje przez Twilio.</li>
            <li>Callback statusu <span class="code">POST /twilio/status</span> aktualizuje delivery status w bazie.</li>
          </ol>

          <h3>News / RAG (scheduler â†’ odbiorcy)</h3>
          <ol>
            <li>Scraper pobiera treÅ›ci do katalogu danych.</li>
            <li>Indeks FAISS jest budowany/aktualizowany (embeddings + mapowanie do dokumentÃ³w).</li>
            <li>O okreÅ›lonej godzinie scheduler generuje streszczenie (RAG) i wysyÅ‚a do odbiorcÃ³w.</li>
          </ol>
        </section>

        <section id="ux" class="card">
          <h2>Panel WWW â€” zakÅ‚adki i widoki</h2>
          <p class="lead">Panel jest responsywny i zoptymalizowany pod pracÄ™ wielu operatorÃ³w. KaÅ¼da zakÅ‚adka skupia siÄ™ na innym procesie, a ukÅ‚ad (flex + grid) pÅ‚ynnie dopasowuje siÄ™ do rozdzielczoÅ›ci i ustawieÅ„ drukowania.</p>

          <div class="callout" style="margin-bottom:16px;background:linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%);border:1px solid #10b981;">
            <strong>ğŸ†• NowoÅ›Ä‡ w ver3.2.3 â€” News Scraping UX Improvements</strong>
            <p class="muted">ZakÅ‚adka News zostaÅ‚a gruntownie ulepszona o real-time progress, kontrolÄ™ procesu i profesjonalny podglÄ…d treÅ›ci.</p>
            <ul>
              <li><strong>ğŸ“¡ SSE Streaming:</strong> Live progress skrapowania z wizualnymi statusami kategorii (âšª oczekuje, ğŸ”„ w trakcie, âœ… sukces, âŒ bÅ‚Ä…d)</li>
              <li><strong>ğŸ›‘ Przycisk â€Zatrzymaj":</strong> Przerwanie procesu skrapowania w dowolnym momencie</li>
              <li><strong>ğŸ—‘ï¸ UsuÅ„ wszystkie:</strong> Masowe kasowanie zeskrapowanych plikÃ³w jednym klikniÄ™ciem</li>
              <li><strong>ğŸ“° Eleganckie kafelki:</strong> Karty plikÃ³w z ikonÄ… gazety, polskim formatem daty, tylko pliki .txt</li>
              <li><strong>ğŸ“„ Pro Preview:</strong> Numerowane artykuÅ‚y z pogrubionym tytuÅ‚em, bez separatorÃ³w</li>
            </ul>
          </div>

          <div class="callout" style="margin-bottom:16px;background:linear-gradient(135deg, #e8f4fd 0%, #f0e6fa 100%);border:1px solid #dbeafe;">
            <strong>ğŸ†• NowoÅ›Ä‡ w ver3.2.2 â€” Collapsible Sidebar</strong>
            <p class="muted">Nowy zwijany sidebar zapewnia wiÄ™cej przestrzeni roboczej. Tryb rozwiniÄ™ty (280px) pokazuje peÅ‚ne etykiety, tryb zwiniÄ™ty (84px) wyÅ›wietla tylko ikony z tooltipami. Stan jest zapisywany w przeglÄ…darce.</p>
            <ul>
              <li><strong>Szybkie akcje:</strong> WyÅ›lij nowÄ… wiadomoÅ›Ä‡ (modal), Historia konwersacji (scroll), OdÅ›wieÅ¼ dane</li>
              <li><strong>SkrÃ³ty klawiszowe:</strong> Ctrl+Enter (wyÅ›lij), Escape (zamknij modal)</li>
              <li><strong>ResponsywnoÅ›Ä‡:</strong> Na mobile sidebar dziaÅ‚a jako overlay z animacjÄ… slide-in</li>
            </ul>
          </div>

          <div class="features" role="list">
            <div class="feature"><strong>Dashboard / WiadomoÅ›ci</strong><div class="muted">Lista konwersacji, filtry statusÃ³w, szybkie przejÅ›cie do czatu.</div></div>
            <div class="feature"><strong>Czat 1:1</strong><div class="muted">Widok szczegÃ³Å‚owy rozmowy, wysyÅ‚ka SMS/MMS, notatki operacyjne.</div></div>
            <div class="feature"><strong>Autoâ€‘reply</strong><div class="muted">PrzeÅ‚Ä…cznik i szablon automatycznej odpowiedzi, kontrola aktywnoÅ›ci.</div></div>
            <div class="feature"><strong>AI Studio</strong><div class="muted">Konfiguracja AI, testy offline, podglÄ…d historii w bÄ…belkach.</div></div>
            <div class="feature"><strong>Przypomnienia</strong><div class="muted">Scheduler cyklicznych SMS-Ã³w, historia wykonaÅ„, diagnostyka.</div></div>
            <div class="feature"><strong>Multiâ€‘SMS</strong><div class="muted">Kampanie batchowe, licznik sukcesÃ³w/bÅ‚Ä™dÃ³w, drill-down odbiorcÃ³w.</div></div>
            <div class="feature"><strong>News / FAISS <span class="badge">3.2.3</span></strong><div class="muted">SSE live progress, zatrzymanie procesu, masowe usuwanie, profesjonalny podglÄ…d artykuÅ‚Ã³w.</div></div>
            <div class="feature"><strong>Admin & Runbook</strong><div class="muted">Linki do dokumentacji, dostÄ™p do logÃ³w, checklisty powdroÅ¼eniowe.</div></div>
          </div>

          <h3>Dashboard i lista wiadomoÅ›ci</h3>
          <p>Strona startowa przedstawia wszystkie aktywne wÄ…tki w jednym miejscu. KaÅ¼dy wiersz zawiera: numer rozmÃ³wcy, skrÃ³t ostatniej wiadomoÅ›ci, kierunek (inbound/outbound), status dostarczenia i sygnaturÄ™ czasu. Filtry zachowujÄ… siÄ™ tak samo w UI i API, dziÄ™ki czemu moÅ¼na je wykorzystywaÄ‡ w automatyzacjach.</p>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_wiadomosci.jpg" alt="Historia wiadomoÅ›ci â€” tabela">
            </div>
            <figcaption>Dashboard â€” kolumny statusÃ³w, oznaczenia kierunku, przyciski przejÅ›cia do czatu i jasne rozrÃ³Å¼nienie kanaÅ‚u.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” historia wiadomoÅ›ci">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>Wiersze z metadanymi (nadawca, skrÃ³t treÅ›ci, status, data/godzina).</li>
                <li>Kolumny dostosowujÄ…ce siÄ™ do szerokoÅ›ci ekranu â€” na mobile przechodzÄ… w karty.</li>
                <li>Ikony kanaÅ‚Ã³w (SMS/WhatsApp) oraz badge informacyjne (np. failed).</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>PrzejÅ›cie do widoku czatu w trybie pojedynczej rozmowy (ikona strzaÅ‚ki).</li>
                <li>Filtrowanie po statusie, dacie lub rodzaju kanaÅ‚u w celu szybkiej diagnostyki.</li>
                <li>Pobranie danych do CSV przez API (te same parametry filtrÃ³w).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co siÄ™ zapisuje</h4>
              <ul>
                <li>KaÅ¼da wiadomoÅ›Ä‡ trafia do SQLite z peÅ‚nym audit logiem statusÃ³w.</li>
                <li>Numery normalizowane sÄ… do E.164, co scala rozmowy niezaleÅ¼nie od formatu.</li>
                <li>Statusy aktualizowane sÄ… przez webhook <span class="code">POST /twilio/status</span>.</li>
              </ul>
            </div>
          </div>

          <h3>Czat 1:1 â€” kontekst operacyjny</h3>
          <p>Po wejÅ›ciu w szczegÃ³Å‚y rozmowy UI przeÅ‚Ä…cza siÄ™ na layout bÄ…belkowy. Po prawej stronie dostÄ™pne sÄ… skrÃ³ty (przeÅ‚Ä…cz miÄ™dzy trybami autoâ€‘reply, podglÄ…d historii statusÃ³w, szybkie szablony). WysyÅ‚anie obsÅ‚uguje SMS i MMS, przelicza segmenty i pokazuje z jakiego numeru/mes saging service skorzystasz.</p>
          <ul>
            <li>WiadomoÅ›ci uÅ‚oÅ¼one chronologicznie, z datÄ…, godzinÄ… i oznaczeniem osoby (operator/klient).</li>
            <li>ZaÅ‚Ä…czniki MMS wyÅ›wietlane jako miniatury, ktÃ³re moÅ¼na otworzyÄ‡ w nowym oknie.</li>
            <li>Status wysyÅ‚ki aktualizowany w czasie rzeczywistym dziÄ™ki pollingowi REST.</li>
          </ul>

          <h3>Autoâ€‘odpowiedÅº (tryb szablonowy)</h3>
          <p>Globalny przeÅ‚Ä…cznik autoâ€‘reply pozwala bÅ‚yskawicznie wÅ‚Ä…czyÄ‡ komunikat informacyjny. Zmiany sÄ… walidowane po stronie klienta i serwera, a worker natychmiast pobiera nowÄ… treÅ›Ä‡.</p>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_autoodpowiedz.jpg" alt="Autoâ€‘odpowiedÅº â€” panel">
            </div>
            <figcaption>ZakÅ‚adka autoâ€‘reply â€” przeÅ‚Ä…cznik ON/OFF, edytor treÅ›ci i status ostatniej wysyÅ‚ki.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” auto-odpowiedÅº">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>Stan aktywacji oraz edytor wiadomoÅ›ci z licznikiem znakÃ³w.</li>
                <li>Informacje o ostatniej automatycznej odpowiedzi (kiedy i do kogo).</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>WÅ‚Ä…czenie/wyÅ‚Ä…czenie trybu bez restartu aplikacji.</li>
                <li>Zmiana treÅ›ci (np. komunikat o awarii) z natychmiastowym zapisem.</li>
                <li>PrzejÅ›cie do AI Studio, jeÅ›li potrzebujesz inteligentniejszego trybu.</li>
              </ul>
              <div class="hint">Aktywacja AI wyÅ‚Ä…cza tryb szablonowy, aby uniknÄ…Ä‡ dublowania odpowiedzi.</div>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>Webhook inbound zapisuje wiadomoÅ›Ä‡ i dodaje zadanie do kolejki.</li>
                <li>Worker autoâ€‘reply wysyÅ‚a odpowiedÅº tylko dla wiadomoÅ›ci nowszych niÅ¼ moment aktywacji.</li>
                <li>KaÅ¼da odpowiedÅº jest audytowana w tabeli <span class="code">messages</span> z flagÄ… automatycznÄ….</li>
              </ul>
            </div>
          </div>

          <h3>Przypomnienia â€” kampanie cykliczne</h3>
          <p>ZakÅ‚adka przypomnieÅ„ zarzÄ…dza kampaniami cyklicznymi (np. raporty dzienne, powiadomienia o pÅ‚atnoÅ›ciach). UI prezentuje stan aktywacji, interwaÅ‚, najbliÅ¼szy termin oraz log wykonania.</p>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_przypomnienie.jpg" alt="Przypomnienia â€” panel">
            </div>
            <figcaption>Lista przypomnieÅ„ â€” przeÅ‚Ä…czniki aktywacji, licznik prÃ³b i historia ostatnich wysyÅ‚ek.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” przypomnienia">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>TabelÄ™ z harmonogramami (numer, treÅ›Ä‡, interwaÅ‚, aktywnoÅ›Ä‡).</li>
                <li>Panel szczegÃ³Å‚Ã³w â€” kiedy ostatnio i nastÄ™pnie zadanie bÄ™dzie wysÅ‚ane.</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>Dodanie nowego przypomnienia z walidacjÄ… formatu numeru i interwaÅ‚u.</li>
                <li>Wstrzymanie/wznowienie oraz rÄ™czne wymuszenie wysyÅ‚ki.</li>
                <li>PodglÄ…d logÃ³w bÅ‚Ä™dÃ³w, jeÅ›li worker napotka problem (np. bÅ‚Ä…d Twilio).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>Worker cyklicznie sprawdza tabelÄ™ <span class="code">scheduled_messages</span>.</li>
                <li>KaÅ¼da prÃ³ba wysyÅ‚ki jest zapisana w historii wiadomoÅ›ci i logach operacyjnych.</li>
                <li>API <span class="code">/api/reminders</span> obsÅ‚uguje CRUD i akcje specjalne.</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="multi-sms" class="card">
          <h2>Multiâ€‘SMS â€” wysyÅ‚ka jednej wiadomoÅ›ci do wielu odbiorcÃ³w</h2>
          <p class="lead">ZakÅ‚adka Multiâ€‘SMS Å‚Ä…czy prostotÄ™ formularza z zaawansowanÄ… kontrolÄ… â€” operator moÅ¼e wkleiÄ‡ numery w dowolnym formacie, uruchomiÄ‡ kampaniÄ™ i Å›ledziÄ‡ kaÅ¼dy odbiÃ³r w czasie rzeczywistym.</p>

          <h3>Jak to dziaÅ‚a (w praktyce)</h3>
          <ol>
            <li>Operator wkleja numery (przecinki / Å›redniki / nowe linie) i treÅ›Ä‡ wiadomoÅ›ci.</li>
            <li>Backend normalizuje numery i zapisuje batch + rekordy odbiorcÃ³w w SQLite.</li>
            <li>Worker w tle rezerwuje najbliÅ¼szy batch <span class="badge">pending</span> i przetwarza odbiorcÃ³w.</li>
            <li>KaÅ¼da prÃ³ba wysyÅ‚ki aktualizuje status odbiorcy oraz liczniki batcha (sukcesy/bÅ‚Ä™dy).</li>
          </ol>

          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_multi_sms.jpg" alt="Multiâ€‘SMS â€” panel i historia batchy">
            </div>
            <figcaption>ZakÅ‚adka Multiâ€‘SMS: u gÃ³ry kreator kampanii, niÅ¼ej lista batchy z licznikami, filtrami i rozwijanÄ… listÄ… odbiorcÃ³w.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” Multi-SMS">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>Formularz utworzenia batcha (treÅ›Ä‡ + lista numerÃ³w).</li>
                <li>HistoriÄ™ batchy z licznikami: wysÅ‚ane / bÅ‚Ä™dy / Å‚Ä…cznie oraz status batcha.</li>
                <li>MoÅ¼liwoÅ›Ä‡ rozwiniÄ™cia listy odbiorcÃ³w i podejrzenia statusÃ³w per numer.</li>
                <li>Badge statusÃ³w (<span class="badge">pending</span>, <span class="badge">processing</span>, <span class="badge">completed</span>, <span class="badge">failed</span>).</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>Wklejenie numerÃ³w w rÃ³Å¼nych formatach (przecinki/linie) â€” system je rozbije, oczyÅ›ci i znormalizuje.</li>
                <li>Utworzenie batcha bez czekania na wysyÅ‚kÄ™ (wysyÅ‚ka idzie w tle).</li>
                <li>Kontrola postÄ™pu: odÅ›wieÅ¼anie historii batchy i rozwijanie odbiorcÃ³w dla wglÄ…du w statusy.</li>
                <li>Diagnostyka bÅ‚Ä™dÃ³w: podejrzenie <em>error</em> per numer (np. niepoprawny format, bÅ‚Ä…d Twilio, brak routingu).</li>
                <li>Pobranie raportu przez API i eksport do CSV (np. dla dziaÅ‚u marketingu).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>Backend tworzy batch i odbiorcÃ³w w SQLite (kolejka DB oparta o statusy).</li>
                <li>Worker rezerwuje batch do przetworzenia, wysyÅ‚a SMS per odbiorca i aktualizuje statusy w tabelach <span class="code">multi_sms_*</span>.</li>
                <li>KaÅ¼da prÃ³ba wysyÅ‚ki jest zapisywana w historii (<span class="code">messages</span>), co daje peÅ‚ny audyt.</li>
                <li>UI pobiera batchy przez <span class="code">GET /api/multi-sms/batches</span> (opcjonalnie wraz z listÄ… odbiorcÃ³w).</li>
              </ul>
            </div>
          </div>

          <div class="callout" style="margin-top:12px">
            <strong>Optymalizacja UX</strong>
            <ul>
              <li>Formularz ma automatyczne przeliczanie liczby odbiorcÃ³w oraz wstÄ™pne czyszczenie numerÃ³w (trim, usuniÄ™cie separacji, walidacja E.164).</li>
              <li>Panel pokazuje skrÃ³ty klawiaturowe i wskazÃ³wki (np. jak wkleiÄ‡ listÄ™ z Excela).</li>
              <li>WskaÅºnik postÄ™pu aktualizuje siÄ™ asynchronicznie (polling co kilka sekund, limitowany by nie obciÄ…Å¼aÄ‡ API).</li>
            </ul>
          </div>

          <h3>Kontrola ryzyka</h3>
          <ul>
            <li><strong>Limit odbiorcÃ³w na batch</strong>: 250 (ochrona kosztÃ³w i przypadkowej wysyÅ‚ki masowej).</li>
            <li><strong>OdpornoÅ›Ä‡ na restart</strong>: stan utrzymywany w bazie, worker po restarcie kontynuuje kolejkÄ™.</li>
            <li><strong>Audyt</strong>: kaÅ¼da wysyÅ‚ka trafia do historii wiadomoÅ›ci oraz ma wynik per odbiorca.</li>
          </ul>
        </section>

        <section id="news" class="card">
          <h2>News / FAISS (RAG) â€” scraping, indeksowanie i dystrybucja</h2>
          <p class="lead">ZakÅ‚adka News prowadzi operatora przez caÅ‚y cykl Å¼ycia informacji: od scrapingu z live progress po dystrybucjÄ™ i backup. KaÅ¼da sekcja ma jasne opisy, kontrolki i mechanizmy bezpieczeÅ„stwa.</p>

          <div class="callout" style="margin-bottom:16px;background:linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%);border:1px solid #10b981;">
            <strong>ğŸ“¡ NowoÅ›Ä‡ ver3.2.3 â€” SSE Streaming i kontrola procesu</strong>
            <table class="spec" style="margin-top:8px">
              <tr><th>Funkcja</th><th>Opis</th></tr>
              <tr><td><strong>Live Progress</strong></td><td>Real-time statusy kategorii: âšª oczekuje, ğŸ”„ w trakcie, âœ… sukces, âŒ bÅ‚Ä…d</td></tr>
              <tr><td><strong>Przycisk â€Zatrzymaj"</strong></td><td>Przerwanie skrapowania w dowolnym momencie</td></tr>
              <tr><td><strong>UsuÅ„ wszystkie</strong></td><td>Masowe kasowanie plikÃ³w scrape jednym klikniÄ™ciem</td></tr>
              <tr><td><strong>Eleganckie kafelki</strong></td><td>Ikona ğŸ“°, polski format daty, tylko pliki .txt</td></tr>
              <tr><td><strong>Pro Preview</strong></td><td>Numerowane artykuÅ‚y, pogrubione tytuÅ‚y, bez separatorÃ³w</td></tr>
            </table>
          </div>

          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_news1.jpg" alt="News â€” panel (konfiguracja i akcje)">
            </div>
            <figcaption>Panel operacyjny: SSE streaming z wizualnymi statusami kategorii, przycisk zatrzymania, podglÄ…d plikÃ³w .txt.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” News (ekran 1)">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>Dynamiczny progress skrapowania z ikonami statusu dla kaÅ¼dej kategorii.</li>
                <li>Przyciski â€Pobierz i zbuduj", â€Zatrzymaj" oraz â€UsuÅ„ wszystkie".</li>
                <li>Eleganckie kafelki plikÃ³w .txt z podglÄ…dem profesjonalnym artykuÅ‚Ã³w.</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>Uruchomienie scrapingu z SSE streaming (real-time aktualizacja statusÃ³w).</li>
                <li>Zatrzymanie procesu w dowolnym momencie jednym klikniÄ™ciem.</li>
                <li>PodglÄ…d artykuÅ‚Ã³w w profesjonalnym formacie (numerowanie, tytuÅ‚y).</li>
                <li>Masowe usuwanie wszystkich plikÃ³w lub pojedyncze kasowanie.</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>SSE endpoint streamuje zdarzenia: start â†’ processing â†’ done â†’ building_faiss â†’ complete.</li>
                <li>Scraper pobiera kategorie sekwencyjnie, UI aktualizuje siÄ™ w czasie rzeczywistym.</li>
                <li>API: <span class="code">GET /api/news/scrape/stream</span>, <span class="code">DELETE /api/news/files</span>.</li>
              </ul>
            </div>
          </div>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_news2.jpg" alt="News â€” odbiorcy i harmonogram">
            </div>
            <figcaption>ZakÅ‚adka odbiorcÃ³w: numer, tryb promptu, godzina wysyÅ‚ki, flagi aktywnoÅ›ci oraz przyciski test/send.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” News (ekran 2)">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>ListÄ™ odbiorcÃ³w powiadomieÅ„ newsowych (numer + godzina + tryb).</li>
                <li>Flagi <span class="badge">enabled</span>, informacjÄ™ o ostatniej wysyÅ‚ce oraz tryb generacji.</li>
                <li>WskaÅºnik liczby artykuÅ‚Ã³w wykorzystanych przy ostatnim wysÅ‚aniu (QA jakoÅ›ci).</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>Dodanie odbiorcy (numer w E.164) i wybÃ³r trybu: wszystkie kategorie (domyÅ›lnie) vs prompt niestandardowy.</li>
                <li>WÅ‚Ä…czenie/wyÅ‚Ä…czenie odbiorcy oraz test wiadomoÅ›ci bez wysyÅ‚ki (preview).</li>
                <li>Force-send (wysyÅ‚ka rÄ™czna) dla odbiorcy w celach operacyjnych i weryfikacji routingu Twilio.</li>
                <li>Eksport listy odbiorcÃ³w do JSON przez API (np. backup lub audyt).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>Konfiguracja odbiorcÃ³w jest zapisywana w pliku <span class="code">news_config.json</span>.</li>
                <li>Scheduler/worker wysyÅ‚a o okreÅ›lonej godzinie wygenerowane streszczenia (jeÅ›li odbiorca jest wÅ‚Ä…czony).</li>
                <li>WysyÅ‚ka jest realizowana przez Twilio i powinna byÄ‡ widoczna w historii wiadomoÅ›ci.</li>
                <li>API: <span class="code">GET/POST/DELETE /api/news/recipients</span> + akcje per odbiorca: <span class="code">toggle</span>, <span class="code">test</span>, <span class="code">send</span>.</li>
              </ul>
            </div>
          </div>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_news3.jpg" alt="News â€” FAISS/status/operacje">
            </div>
            <figcaption>ZakÅ‚adka FAISS: status indeksu, informacje o modelach oraz akcje import/eksport (backup ZIP).</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” News (ekran 3)">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>Status indeksu (czy zaÅ‚adowany, ile wektorÃ³w, jakie modele embeddings/chat).</li>
                <li>GotowoÅ›Ä‡ backupu (wymagane pliki) oraz operacje import/export.</li>
                <li>InformacjÄ™ o tym, ktÃ³ry plik manifestu jest aktywny i kiedy ostatnio przeprowadzono backup.</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>Eksport backupu (ZIP) i import w celu odtworzenia Å›rodowiska (np. po wdroÅ¼eniu lub awarii).</li>
                <li>Budowa indeksu z istniejÄ…cych plikÃ³w oraz test zapytaÅ„ FAISS (diagnostyka jakoÅ›ci i â€Å›wieÅ¼oÅ›ciâ€ danych).</li>
                <li>Pobranie manifestu i zapisanie go do runbooka (kontrola zmian miÄ™dzy Å›rodowiskami).</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>FAISS przechowuje wektory embeddings + mapowanie do dokumentÃ³w.</li>
                <li>Zapytania RAG pobierajÄ… kontekst z indeksu i opcjonalnie uÅ¼ywajÄ… LLM do sformatowania odpowiedzi.</li>
                <li>API: <span class="code">GET /api/news/faiss/status</span>, <span class="code">GET /api/news/faiss/export</span>, <span class="code">POST /api/news/faiss/import</span>, <span class="code">POST /api/news/test-faiss</span>.</li>
              </ul>
            </div>
          </div>

          <div class="callout" style="margin-top:12px">
            <strong>WskazÃ³wki operacyjne</strong>
            <ul>
              <li>Przed importem backupu sprawdÅº, czy Å›rodowisko ma wolne 250&nbsp;MB (limit bezpieczeÅ„stwa).</li>
              <li>Po imporcie UI wymusza odÅ›wieÅ¼enie indeksu w workerze, aby nowy zestaw dokumentÃ³w byÅ‚ aktywny.</li>
              <li>Endpoint testowy <span class="code">POST /api/news/test-faiss</span> pozwala oceniÄ‡ jakoÅ›Ä‡ streszczeÅ„ przed wysyÅ‚kÄ… produkcyjnÄ….</li>
            </ul>
          </div>

          <h3>API moduÅ‚u News (skrÃ³t)</h3>
          <ul>
            <li><strong>Konfiguracja/odbiorcy</strong>: <span class="code">GET /api/news/config</span>, <span class="code">GET/POST/DELETE /api/news/recipients</span>, <span class="code">POST /api/news/recipients/&lt;id&gt;/(toggle|test|send)</span></li>
            <li><strong>Scraping (SSE)</strong>: <span class="code">GET /api/news/scrape/stream</span> (live progress), <span class="code">POST /api/news/scrape</span> (legacy)</li>
            <li><strong>Pliki</strong>: <span class="code">GET /api/news/files</span>, <span class="code">DELETE /api/news/files</span> (masowe usuwanie), <span class="code">DELETE /api/news/files/&lt;filename&gt;</span></li>
            <li><strong>FAISS</strong>: <span class="code">GET /api/news/faiss/status</span>, <span class="code">GET /api/news/faiss/export</span>, <span class="code">POST /api/news/faiss/import</span>, <span class="code">POST /api/news/indices/build</span></li>
          </ul>
          <p class="muted">Import backupu ma limit bezpieczeÅ„stwa 250&nbsp;MB. Endpoint SSE streamuje zdarzenia JSON w formacie EventSource.</p>
        </section>

        <section id="data" class="card">
          <h2>Dane (SQLite) â€” trwaÅ‚oÅ›Ä‡, backup i migracje</h2>
          <p class="lead">Aplikacja przechowuje stan w SQLite (domyÅ›lnie <span class="code">data/app.db</span>). Schemat zostaÅ‚ zaprojektowany tak, aby wszystkie moduÅ‚y (panel, API, workery) korzystaÅ‚y z jednego ÅºrÃ³dÅ‚a prawdy.</p>
          <h3>Co jest zapisywane</h3>
          <ul>
            <li><strong>messages</strong>: historia inbound/outbound, SID Twilio, status, bÅ‚Ä™dy i timestamps.</li>
            <li><strong>multi_sms_*</strong>: batch + odbiorcy (statusy, liczniki, bÅ‚Ä™dy per numer).</li>
            <li><strong>reminders</strong>: harmonogramy cyklicznych wysyÅ‚ek.</li>
            <li><strong>news_config.json</strong>: konfiguracja odbiorcÃ³w News (plik w katalogu danych).</li>
            <li><strong>settings</strong>: konfiguracja autoâ€‘reply, AI i innych przeÅ‚Ä…cznikÃ³w panelu.</li>
          </ul>
          <h3>Backup (praktycznie)</h3>
          <ul>
            <li>Najprostszy backup to kopia pliku DB (przy zatrzymanej aplikacji lub w oknie niskiej aktywnoÅ›ci).</li>
            <li>FAISS posiada dedykowany eksport/import ZIP z manifestem (API moduÅ‚u News).</li>
            <li>Przed aktualizacjÄ… schematu wykonaj migracjÄ™ (skrypt <span class="code">manage.py db upgrade</span>, jeÅ›li wÅ‚Ä…czone Alembic) lub snapshot pliku.</li>
          </ul>
          <div class="callout">
            <strong>Retencja i compliance</strong>
            <ul>
              <li>RetencjÄ™ wiadomoÅ›ci moÅ¼esz kontrolowaÄ‡ jobem czyszczÄ…cym (np. cron + skrypt SQL DELETE WHERE).</li>
              <li>Indeks FAISS przechowuje embedowane teksty â€” dla RODO usuÅ„ dokumenty ÅºrÃ³dÅ‚owe i przebuduj indeks.</li>
              <li>KaÅ¼da tabela ma klucz <span class="code">created_at</span>, co uÅ‚atwia audyt i raporty SLA.</li>
            </ul>
          </div>
        </section>

        <section id="api" class="card">
          <h2>API â€” integracja i automatyzacja</h2>
          <p class="lead">Panel WWW korzysta z REST API, ktÃ³re moÅ¼esz rÃ³wnieÅ¼ wywoÅ‚ywaÄ‡ z systemÃ³w zewnÄ™trznych (CRM, marketing automation, chatboty). PoniÅ¼ej skrÃ³t najczÄ™Å›ciej uÅ¼ywanych endpointÃ³w.</p>
          <table class="spec">
            <tr><th>Endpoint</th><th>Opis</th></tr>
            <tr><td><span class="code">GET /api/messages</span></td><td>Lista wiadomoÅ›ci z filtrami (status, kierunek, data). UÅ¼ywana w dashboardzie.</td></tr>
            <tr><td><span class="code">GET /api/conversations</span></td><td>Lista konwersacji (unikalne numery) z metadanymi ostatniego kontaktu.</td></tr>
            <tr><td><span class="code">GET /api/conversations/&lt;participant&gt;</span></td><td>Historia rozmowy (czat 1:1) â€” to samo, co widzi operator.</td></tr>
            <tr><td><span class="code">POST /api/send-message</span></td><td>WysyÅ‚ka SMS/MMS; przyjmuje numer odbiorcy, treÅ›Ä‡, opcjonalnie <span class="code">media_url</span>.</td></tr>
            <tr><td><span class="code">POST /api/multi-sms/batches</span></td><td>Utworzenie kampanii multi-SMS (lista numerÃ³w + treÅ›Ä‡).</td></tr>
            <tr><td><span class="code">GET /api/multi-sms/batches</span></td><td>Lista kampanii z licznikami i statusami.</td></tr>
            <tr><td><span class="code">GET /api/multi-sms/batches/&lt;id&gt;/recipients</span></td><td>Lista odbiorcÃ³w z wynikami (sent/failed, kod bÅ‚Ä™du).</td></tr>
            <tr><td><span class="code">POST /api/reminders</span></td><td>Tworzenie przypomnienia (numer, treÅ›Ä‡, interwaÅ‚).</td></tr>
            <tr><td><span class="code">GET /api/news/scrape/stream</span></td><td>SSE streaming postÄ™pu skrapowania z wizualnymi statusami kategorii <span class="badge">3.2.3</span>.</td></tr>
            <tr><td><span class="code">DELETE /api/news/files</span></td><td>Masowe usuwanie wszystkich plikÃ³w scrape <span class="badge">3.2.3</span>.</td></tr>
            <tr><td><span class="code">POST /api/news/scrape</span></td><td>Uruchomienia scrapingu newsÃ³w (planowane bÄ…dÅº manualne).</td></tr>
            <tr><td><span class="code">GET /api/news/faiss/status</span></td><td>Status indeksu, modele, informacja o backupie.</td></tr>
            <tr><td><span class="code">POST /api/ai/test</span></td><td>Test odpowiedzi AI bez wysyÅ‚ania SMS (tryb preview).</td></tr>
          </table>
          <div class="callout" style="margin-top:12px">
            <strong>Autoryzacja i rate limiting</strong>
            <ul>
              <li>Webhooki Twilio uÅ¼ywajÄ… podpisu <span class="code">X-Twilio-Signature</span>; pozostaÅ‚e endpointy mogÄ… byÄ‡ zabezpieczone tokenem (Bearer) lub Basic Auth â€” zaleÅ¼nie od konfiguracji reverse proxy.</li>
              <li>Wbudowane ograniczenia: 5 Å¼Ä…daÅ„/sek. na wskaÅºnik statusÃ³w (ochrona przed floodem), 1 kampania Multiâ€‘SMS na minutÄ™ (domyÅ›lnie).</li>
              <li>DostÄ™pne formaty odpowiedzi: JSON (UTF-8). W przypadku bÅ‚Ä™dÃ³w zwracany jest kod HTTP 4xx/5xx z opisem.</li>
            </ul>
          </div>
        </section>

        <section id="glossary" class="card">
          <h2>Glosariusz i najwaÅ¼niejsze pojÄ™cia</h2>
          <p class="lead">Ten rozdziaÅ‚ porzÄ…dkuje terminologiÄ™ spotykanÄ… w panelach i API, aby PDF byÅ‚ samowystarczalny dla zespoÅ‚Ã³w biznesowych i technicznych.</p>
          <ul>
            <li><strong>Batch (Multiâ€‘SMS)</strong> â€” zadanie wysyÅ‚ki jednej wiadomoÅ›ci do wielu odbiorcÃ³w; posiada status (<span class="badge">pending</span>, <span class="badge">processing</span>, <span class="badge">completed</span>, <span class="badge">failed</span>) i liczniki skutecznoÅ›ci.</li>
            <li><strong>Recipient (Multiâ€‘SMS)</strong> â€” pojedynczy numer przypisany do batcha; system Å›ledzi status (<span class="badge">pending</span> / <span class="badge">sent</span> / <span class="badge">failed</span>) oraz ewentualny bÅ‚Ä…d Twilio.</li>
            <li><strong>Messaging Service SID</strong> â€” identyfikator grupujÄ…cy numery w Twilio; jeÅ›li skonfigurowany, Multiâ€‘SMS i UI uÅ¼ywajÄ… go jako nadawcy zamiast pojedynczego numeru.</li>
            <li><strong>Webhook</strong> â€” endpoint HTTP nasÅ‚uchujÄ…cy Å¼Ä…daÅ„ Twilio (np. inbound wiadomoÅ›ci, status dostarczenia). KaÅ¼dy webhook jest podpisany nagÅ‚Ã³wkiem <span class="code">X-Twilio-Signature</span>.</li>
            <li><strong>FAISS</strong> â€” biblioteka wektorowa uÅ¼ywana do szybkiego wyszukiwania podobnych dokumentÃ³w, podstawowy komponent moduÅ‚u News/RAG.</li>
            <li><strong>Scraper</strong> â€” proces pobierajÄ…cy artykuÅ‚y i zapisujÄ…cy je w katalogu danych; jego wynik zasila FAISS i moduÅ‚ News.</li>
            <li><strong>Reminder</strong> â€” harmonogram cyklicznej wysyÅ‚ki SMS. KaÅ¼de przypomnienie opisuje numer docelowy, treÅ›Ä‡ i interwaÅ‚.</li>
            <li><strong>Autoâ€‘reply</strong> â€” mechanizm automatycznych odpowiedzi (klasyczny lub AI). W trybie AI kaÅ¼de zapytanie jest przekazywane do modelu OpenAI z kontekstem rozmowy.</li>
            <li><strong>Normalized number</strong> â€” numer telefonu po oczyszczeniu (E.164). Pozwala scalaÄ‡ rekordy w historii i zapobiegaÄ‡ duplikatom.</li>
            <li><strong>News recipient</strong> â€” wpis w <span class="code">news_config.json</span>; okreÅ›la numer, godzinÄ™ wysyÅ‚ki i tryb promptu (wszystkie kategorie vs. prompt niestandardowy).</li>
          </ul>
        </section>

        <section id="ai" class="card">
          <h2>AI & Autoâ€‘reply â€” zasady dziaÅ‚ania</h2>
          <p class="lead">ZakÅ‚adka AI Studio to centrum konfiguracji inteligentnych odpowiedzi. Pozwala wybraÄ‡ model, zdefiniowaÄ‡ prompt, ustawiÄ‡ parametry (temperatura, limit historii) i wykonaÄ‡ test bez obciÄ…Å¼ania budÅ¼etu SMS.</p>
          <ol>
            <li>AI buduje historiÄ™ rozmowy z tabeli `messages` i wysyÅ‚a zapytanie do OpenAI.</li>
            <li>Odpowiedzi sÄ… wysyÅ‚ane tak, aby zachowaÄ‡ wÄ…tek konwersacji (preferowana metoda `send_reply_to_inbound`).</li>
            <li>Operator moÅ¼e przetestowaÄ‡ model w zakÅ‚adce AI bez wysyÅ‚ania SMS (endpoint `POST /api/ai/test`).</li>
          </ol>
          <figure class="doc-figure">
            <div class="screenshot">
              <img src="../../app/screenshot/panel_ai.jpg" alt="AI â€” panel konfiguracji i testÃ³w">
            </div>
            <figcaption>AI Studio: przeÅ‚Ä…cznik trybu, ustawienia modelu, parametry generacji, edytor promptu i panel testowy w stylu czatu.</figcaption>
          </figure>
          <div class="panel-notes" aria-label="Opis panelu â€” AI">
            <div class="note">
              <h4>Co widzisz</h4>
              <ul>
                <li>KonfiguracjÄ™ AI (wÅ‚Ä…czenie, model, prompt systemowy, temperatura, limit historii).</li>
                <li>PodglÄ…d kontekstu w formie bÄ…belkÃ³w (ostatnie wiadomoÅ›ci, ktÃ³re trafiÄ… do LLM).</li>
                <li>Panel testowy, ktÃ³ry pozwala zweryfikowaÄ‡ odpowiedÅº i ewentualnie jÄ… poprawiÄ‡ przed wysyÅ‚kÄ….</li>
              </ul>
            </div>
            <div class="note">
              <h4>MoÅ¼liwe interakcje</h4>
              <ul>
                <li>WÅ‚Ä…czenie AI autoâ€‘reply i dostosowanie promptu pod gÅ‚os marki (tone of voice, disclaimers).</li>
                <li>Test generacji bez wysyÅ‚ki (tekst lub JSON) oraz porÃ³wnanie z odpowiedziÄ… klasycznÄ….</li>
                <li>Eksport konfiguracji promptu do JSON (przez API), aby dzieliÄ‡ siÄ™ ustawieniami miÄ™dzy Å›rodowiskami.</li>
              </ul>
            </div>
            <div class="note">
              <h4>Co dzieje siÄ™ w tle</h4>
              <ul>
                <li>AI buduje kontekst z historii wiadomoÅ›ci i wywoÅ‚uje OpenAI wg ustawieÅ„ (model/temperatura/limit historii).</li>
                <li>JeÅ›li tryb autoâ€‘reply jest aktywny, inbound webhook enqueueâ€™uje zadanie odpowiedzi (bez blokowania requestu).</li>
                <li>WysyÅ‚ka odpowiedzi przez Twilio jest rejestrowana w <span class="code">messages</span>; statusy mogÄ… siÄ™ aktualizowaÄ‡ callbackiem.</li>
                <li>System unika odpowiedzi na starsze wiadomoÅ›ci sprzed aktywacji trybu (brak retroâ€‘odpowiedzi).</li>
                <li>UI regularnie sprawdza status klucza OpenAI przez <span class="code">GET /api/openai/status</span> i komunikuje ewentualne braki.</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="security" class="card">
          <h2>BezpieczeÅ„stwo â€” kluczowe zasady</h2>
          <p class="lead">System jest zbudowany tak, aby minimalizowaÄ‡ ryzyko nieautoryzowanych wywoÅ‚aÅ„ webhookÃ³w, wyciekÃ³w kluczy oraz niekontrolowanej wysyÅ‚ki.</p>
          <h3>Webhooki Twilio: walidacja podpisu</h3>
          <ul>
            <li>Callbacki Twilio sÄ… weryfikowane nagÅ‚Ã³wkiem <span class="code">X-Twilio-Signature</span> (RequestValidator).</li>
            <li>WalidacjÄ™ moÅ¼na wyÅ‚Ä…czyÄ‡ tylko dla testÃ³w lokalnych przez <span class="code">TWILIO_VALIDATE_SIGNATURE=false</span> (produkcyjnie: zostawiÄ‡ wÅ‚Ä…czonÄ…).</li>
          </ul>
          <h3>Klucze i konfiguracja</h3>
          <ul>
            <li>Dane dostÄ™powe Twilio sÄ… pobierane ze zmiennych Å›rodowiskowych i nie powinny trafiaÄ‡ do repozytorium.</li>
            <li>DB jest plikiem (SQLite) â€” w produkcji zadbaj o uprawnienia do katalogu <span class="code">data/</span> oraz backup.</li>
          </ul>
          <h3>Kontrola kosztÃ³w</h3>
          <ul>
            <li>Multiâ€‘SMS ma limit odbiorcÃ³w per batch.</li>
            <li>News wysyÅ‚a wiadomoÅ›ci tylko do wÅ‚Ä…czonych odbiorcÃ³w; testy mogÄ… dziaÅ‚aÄ‡ bez wysyÅ‚ki.</li>
          </ul>
        </section>

        <section id="monitoring" class="card">
          <h2>Logi & monitoring</h2>
          <p class="lead">Operacyjne utrzymanie aplikacji opiera siÄ™ na logach strukturalnych, healthchecku HTTP i prostych metrykach liczonych w SQLite. PoniÅ¼ej zalecenia dla Å›rodowisk produkcyjnych.</p>
          <div class="two-col" aria-label="Monitoring i logowanie">
            <div class="callout">
              <strong>Logowanie</strong>
              <ul>
                <li>Flask loguje w formacie JSON (timestamp, poziom, moduÅ‚, komunikat).</li>
                <li>Workery (autoâ€‘reply, reminders, multiâ€‘sms, news) raportujÄ… start/stop oraz bÅ‚Ä™dy w osobnych namespace'ach.</li>
                <li>Polecenie <span class="code">docker compose logs -f web</span> lub integracja z Elastic/Splunk.</li>
              </ul>
            </div>
            <div class="callout">
              <strong>Monitoring</strong>
              <ul>
                <li>Healthcheck: <span class="code">GET /api/health</span> (wykorzystywany przez Docker i load balancer).</li>
                <li>Walidacja klucza OpenAI: <span class="code">GET /api/openai/status</span>.</li>
                <li>Proste metryki (liczba wiadomoÅ›ci, bÅ‚Ä™dÃ³w) moÅ¼na odczytaÄ‡ zapytaniami SQL lub endpointami batchowymi.</li>
              </ul>
            </div>
          </div>
          <div class="callout" style="margin-top:12px">
            <strong>Alerting</strong>
            <ul>
              <li>Konfiguruj alert, gdy healthcheck zwrÃ³ci != 200 przez >3 prÃ³by (grace period 90s).</li>
              <li>Monitoruj liczbÄ™ rekordÃ³w ze statusem <em>failed</em> w tabeli <span class="code">messages</span>; prÃ³g zaleÅ¼ny od biznesu.</li>
              <li>Logi z workerÃ³w zawierajÄ… <span class="code">task_id</span> â€” powiÄ…Å¼ je z narzÄ™dziami observability dla szybkiej diagnozy.</li>
            </ul>
          </div>
        </section>

        <section id="operations" class="card">
          <h2>Operacje â€” uruchomienie i utrzymanie</h2>
          <p class="lead">Aplikacja uruchamia workery w tle (m.in. Multiâ€‘SMS, przypomnienia, News). NajwaÅ¼niejsze operacyjnie jest przewidywalne Å›rodowisko, logi i backup danych.</p>
          <h3>Åšrodowisko</h3>
          <ul>
            <li><strong>DB</strong>: <span class="code">DB_PATH</span> (domyÅ›lnie <span class="code">data/app.db</span>)</li>
            <li><strong>Twilio</strong>: <span class="code">TWILIO_ACCOUNT_SID</span>, <span class="code">TWILIO_AUTH_TOKEN</span>, oraz <span class="code">TWILIO_DEFAULT_FROM</span> lub <span class="code">TWILIO_MESSAGING_SERVICE_SID</span></li>
            <li><strong>AI/FAISS</strong>: konfiguracja OpenAI (jeÅ›li uÅ¼ywana) + pliki indeksu w katalogu danych</li>
          </ul>
          <h3>Diagnostyka</h3>
          <ul>
            <li>JeÅ›li Multiâ€‘SMS nie wysyÅ‚a: sprawdÅº logi workera oraz czy tabele <span class="code">multi_sms_batches</span> i <span class="code">multi_sms_recipients</span> istniejÄ… w DB.</li>
            <li>JeÅ›li News/FAISS nie dziaÅ‚a: sprawdÅº status <span class="code">GET /api/news/faiss/status</span> i czy scraping zbudowaÅ‚ indeks.</li>
          </ul>
          <h3>Backup</h3>
          <ul>
            <li>SQLite: kopia pliku DB + rotacja (np. dzienna).</li>
            <li>FAISS: eksport ZIP przez endpoint i/lub zrzut katalogu indeksu.</li>
          </ul>
        </section>

        <section id="deploy" class="card">
          <h2>Deployment & generowanie PDF</h2>
          <p class="lead">Plik HTML jest przygotowany do konwersji do PDF. Dla spÃ³jnych rezultatÃ³w rekomendowane jest uÅ¼ycie silnika drukowania z obsÅ‚ugÄ… CSS <span class="code">@media print</span>.</p>
          <h4 id="download">Jak wygenerowaÄ‡ PDF</h4>
          <p class="muted">NajproÅ›ciej: uÅ¼yj funkcji â€Drukujâ€ w przeglÄ…darce (zaznacz <em>drukuj tÅ‚a</em>, format A4). JeÅ›li uÅ¼ywasz <span class="code">wkhtmltopdf</span>, pamiÄ™taj o dostÄ™pie do lokalnych plikÃ³w i tym, Å¼e starsze silniki mogÄ… mieÄ‡ ograniczonÄ… obsÅ‚ugÄ™ nowoczesnego CSS â€” ten dokument ma fallback layout, aby temu przeciwdziaÅ‚aÄ‡.</p>
          <h5>Druk z przeglÄ…darki</h5>
          <pre class="code">OtwÃ³rz deploy/releases/full_documentation.html â†’ Ctrl/Cmd+P â†’ Zapisz jako PDF</pre>
          <h5>wkhtmltopdf</h5>
          <pre class="code">wkhtmltopdf --enable-local-file-access --print-media-type deploy/releases/full_documentation.html twilio-chat-app.pdf</pre>
        </section>
      </main>

      <aside class="sidebar">
        <section class="card">
          <h3>Kontakt i wartoÅ›ci</h3>
          <p class="muted">Twilio Chat App â€” gotowe rozwiÄ…zanie do szybkiego uruchomienia kanaÅ‚u SMS z AI.</p>
          <p><strong>KorzyÅ›ci:</strong></p>
          <ul>
            <li>Szybkie wdroÅ¼enie</li>
            <li>PeÅ‚na kontrola nad danymi</li>
            <li>Skalowalna automatyzacja</li>
          </ul>
        </section>

        <section class="card" style="margin-top:12px">
          <h4>MateriaÅ‚y wizualne</h4>
          <p class="muted">Screenshoty sÄ… osadzone jako figury z podpisami i sÄ… przygotowane pod druk/PDF. Pliki ÅºrÃ³dÅ‚owe znajdujÄ… siÄ™ w <code>app/screenshot/</code>.</p>
        </section>
      </aside>
    </div>

    <footer>
      <div>Twilio Chat App â€¢ ver3.2.3 â€¢ 2025-12-23</div>
    </footer>
  </div>
</body>
</html>
