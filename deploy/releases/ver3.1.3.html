<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Twilio Chat App – ver3.1.3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif; margin: 2rem auto; max-width: 960px; line-height: 1.7; color: #1c1c1c; padding: 0 1rem; }
    h1, h2, h3 { color: #111; }
    code { background: #f5f5f5; padding: 0.12rem 0.4rem; border-radius: 4px; font-size: 0.95em; }
    ul { margin-left: 1.2rem; }
    .meta { font-size: 0.95rem; color: #555; margin-bottom: 1.4rem; }
    .tag { font-family: "JetBrains Mono", SFMono-Regular, Menlo, monospace; background: #eef; padding: 0.12rem 0.5rem; border-radius: 4px; }
    section { margin-bottom: 1.9rem; }
    .callout { background: #f8fbff; border: 1px solid #e3edff; padding: 0.85rem 1rem; border-radius: 8px; }
    @media (max-width: 640px) { body { margin: 1.5rem auto; } }
  </style>
</head>
<body>
  <header>
    <h1>Twilio Chat App – <span class="tag">ver3.1.3</span></h1>
    <p class="meta">
      Release tag: <code>ver3.1.3</code><br />
      Data wydania: 2025-12-14<br />
      Środowisko referencyjne: Docker (Python 3.12, gunicorn)
    </p>
  </header>

  <section>
    <h2>Podsumowanie</h2>
    <p>
      Wersja 3.1.3 eliminuje błędy Twilio dla długich wiadomości AI/News, dzieląc treść
      na bezpieczne części (limit 1500 znaków) i wysyłając je jako kilka SMS-ów. Wydanie
      porządkuje też dokumentację (README, docs/ oraz pełną dokumentację HTML) oraz
      ujednolica instrukcje publikacji release.
    </p>
  </section>

  <section>
    <h2>Technologie i środowisko</h2>
    <ul>
      <li>Python 3.12, Flask 3, gunicorn.</li>
      <li>SQLite (`data/app.db`) z automatycznymi migracjami.</li>
      <li>Integracje: Twilio (SMS), OpenAI (AI + embeddings), LangChain/FAISS.</li>
    </ul>
  </section>

  <section>
    <h2>Najważniejsze zmiany</h2>

    <h3>1. Bezpieczna wysyłka długich treści SMS</h3>
    <ul>
      <li>`app/message_utils.py` – `split_sms_chunks()` + `MAX_SMS_CHARS = 1500`, cięcie po akapitach/zdaniach lub twarde, gdy trzeba.</li>
      <li>`app/twilio_client.py` – `send_chunked_sms()` zwraca metadane o częściach (SID-y, liczba znaków) i kończy wysyłkę, jeśli któraś część się nie powiedzie.</li>
      <li>News/RAG (ręczny send, scheduler) oraz AI auto-reply/AI send używają wysyłki wieloczęściowej zamiast obcinania treści.</li>
    </ul>

    <h3>2. Dokumentacja i release hygiene</h3>
    <ul>
      <li>README opisuje mapę dokumentacji (MD/HTML) oraz sekcję o limitach SMS i dzieleniu treści.</li>
      <li>`docs/` i `deploy/releases/full_documentation.html` uzupełniono o informacje o dzieleniu SMS i nowe oznaczenie wersji.</li>
      <li>`release/README.md` aktualizuje instrukcję budowy paczki (prepare_release_bundle).</li>
    </ul>
  </section>

  <section class="callout">
    <h3>Kompatybilność i upgrade</h3>
    <ul>
      <li>Brak zmian w publicznych endpointach API.</li>
      <li>Jedna odpowiedź może być wysłana jako kilka SMS-ów (kilka SID-ów) — uwzględnij to, jeśli monitorujesz SID per wiadomość w zewnętrznych integracjach.</li>
    </ul>
  </section>

  <section>
    <h2>Publikacja release na GitHubie</h2>
    <ol>
      <li>Releases → Draft a new release.</li>
      <li>Tag: <code>ver3.1.3</code>, tytuł: <code>ver3.1.3 – Chunked SMS &amp; docs refresh</code>.</li>
      <li>Wklej treść tego pliku do opisu.</li>
      <li>Opcjonalnie dołącz paczkę z `release/dist/ver3.1.3/` (zbuduj: <code>./scripts/prepare_release_bundle.sh ver3.1.3</code>).</li>
    </ol>
  </section>

  <section>
    <h2>Release bundle (TL;DR)</h2>
    <pre><code>./scripts/prepare_release_bundle.sh ver3.1.3
cd release/dist/ver3.1.3
# zweryfikuj zawartość → brak .env, data/, X1_data/
tar -czf ../ver3.1.3-clean.tar.gz .
    </code></pre>
    <p>Paczka jest gotowa do udostępnienia klientom bez ryzyka wycieku danych newsowych czy sekretów.</p>
  </section>
</body>
</html>
